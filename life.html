<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Conway's Game of Life</title>
        <style>
            * {
                box-sizing: border-box;
            }

            body {
                background: #313131;
                color: bisque;
                font-family: sans-serif;
                margin: 0;
                padding: 10px;
            }

            .btn {
                color: white;
                padding: 10px;
                cursor: pointer;
                width: 100px;
                border: none;
                transition: background-color 0.3s;
                display: block;
                margin: 0 auto;
            }

            p {
                font-size: 18px;
                text-align: center;
            }

            .title {
                text-align: center;
                font-size: 36px;
                text-decoration: none;
                transition: color 0.3s;
                width: 100%;
                display: block;
                color: inherit;
            }

            .title:visited {
                color: inherit;
            }

            .title:hover {
                color: beige;
            }

            .buttons {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin: 20px auto 30px;
                max-width: 600px;
            }

            .clear {
                background-color: #900;
            }

            .clear:hover {
                background-color: #700;
            }

            .play {
                background-color: #060;
            }

            .play:hover {
                background-color: #040;
            }

            .random {
                background-color: #006;
            }

            .random:hover {
                background-color: #004;
            }

            .next {
                background-color: #606;
            }

            .next:hover {
                background-color: #404;
            }

            canvas {
                border: 1px solid #000;
                background-color: #ddd;
                margin: 0 auto;
                display: block;
            }
        </style>
    </head>

    <body>
        <a
            class="title"
            href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life"
            >Conway's Game of Life</a
        >
        <div class="buttons">
            <button class="btn play">Play/stop</button>
            <button class="btn next">Step</button>
            <button class="btn random">Randomize</button>
            <button class="btn clear">Clear area</button>
        </div>
        <canvas id="area" width="700" height="700"></canvas>
        <p>Draw by mouse, erase by mouse + shift</p>

        <script>
            //vars
            let areaSizeX = 150;
            let areaSizeY = 70;
            let cellSize = 10;
            let speed = 50;
            let timer = null;
            let isPlaying = false;
            let mouseIsPushed = false;
            const coords = [
                { x: 1, y: 1 },
                { x: 1, y: -1 },
                { x: 1, y: 0 },
                { x: 0, y: 1 },
                { x: 0, y: -1 },
                { x: -1, y: 1 },
                { x: -1, y: -1 },
                { x: -1, y: 0 },
            ];
            const cellsActions = {
                1: {
                    0: die,
                    1: die,
                    2: noChange,
                    3: noChange,
                    4: die,
                    5: die,
                    6: die,
                    7: die,
                    8: die,
                },
                0: {
                    0: noChange,
                    1: noChange,
                    2: noChange,
                    3: born,
                    4: noChange,
                    5: noChange,
                    6: noChange,
                    7: noChange,
                    8: noChange,
                },
            };
            //elements
            let canvas = document.querySelector("#area");
            const next = document.querySelector(".next");
            const clear = document.querySelector(".clear");
            const play = document.querySelector(".play");
            const random = document.querySelector(".random");

            //main arrays
            let firstGeneration = JSON.parse(
                JSON.stringify(
                    new Array(areaSizeY).fill(new Array(areaSizeX).fill(0))
                )
            );

            let secondGeneration = JSON.parse(
                JSON.stringify(
                    new Array(areaSizeY).fill(new Array(areaSizeX).fill(0))
                )
            );

            //init
            canvas.setAttribute("width", areaSizeX * cellSize);
            canvas.setAttribute("height", areaSizeY * cellSize);
            let context = canvas.getContext("2d");

            lifeCycle();
            renderArea(secondGeneration);

            //handlers
            next.onclick = () => {
                stopLife();
                lifeCycle();
                renderArea(secondGeneration);
            };
            clear.onclick = () => {
                for (let i = 0; i < firstGeneration.length; i++) {
                    for (let k = 0; k < firstGeneration[i].length; k++) {
                        firstGeneration[i][k] = 0;
                    }
                }
                renderArea(firstGeneration);
                stopLife();
            };
            random.onclick = () => {
                randomize();
            };
            play.onclick = () => {
                if (isPlaying) {
                    stopLife();
                } else {
                    playLife();
                }
            };
            canvas.onclick = (e) => {
                mouseHandler(e);
            };
            function mouseHandler(e) {
                let cell = getCoordsOfCell(e.offsetX, e.offsetY);
                firstGeneration[cell.y][cell.x] = e.shiftKey ? 0 : 1;
                renderArea(firstGeneration);
            }
            canvas.onmousedown = (e) => {
                mouseIsPushed = true;
            };
            canvas.onmouseup = (e) => {
                mouseIsPushed = false;
            };
            canvas.onmousemove = (e) => {
                if (mouseIsPushed) {
                    mouseHandler(e);
                }
            };

            //functions
            function drawCell(x, y, alive) {
                context.fillStyle = "black";
                context.fillRect(x, y, cellSize, cellSize);
                context.fillStyle = alive ? "#900" : "#eee";
                context.fillRect(
                    x + 0.3,
                    y + 0.3,
                    cellSize - 0.6,
                    cellSize - 0.6
                );
            }
            function getCoordsOfCell(x, y) {
                return {
                    x: parseInt(x / cellSize),
                    y: parseInt(y / cellSize),
                };
            }
            function renderArea(area) {
                for (let i = 0; i < area.length; i++) {
                    for (let k = 0; k < area[i].length; k++) {
                        drawCell(k * cellSize, i * cellSize, !!area[i][k]);
                    }
                }
                if (area === secondGeneration) {
                    for (let i = 0; i < firstGeneration.length; i++) {
                        for (let k = 0; k < firstGeneration[i].length; k++) {
                            firstGeneration[i][k] = secondGeneration[i][k];
                            secondGeneration[i][k] = 0;
                        }
                    }
                }
            }

            function die(x, y) {
                secondGeneration[y][x] = 0;
            }
            function born(x, y) {
                secondGeneration[y][x] = 1;
            }
            function noChange() {
                return;
            }

            function lifeCycle() {
                for (let i = 0; i < firstGeneration.length; i++) {
                    for (let k = 0; k < firstGeneration[i].length; k++) {
                        secondGeneration[i][k] = firstGeneration[i][k];
                    }
                }
                for (let i = 0; i < firstGeneration.length; i++) {
                    for (let k = 0; k < firstGeneration[i].length; k++) {
                        let neighbors = 0;
                        for (let n = 0; n < coords.length; n++) {
                            if (
                                firstGeneration?.[i + coords?.[n]?.y]?.[
                                    k + coords?.[n]?.x
                                ]
                            ) {
                                if (
                                    firstGeneration[i + coords[n].y][
                                        k + coords[n].x
                                    ] === 1
                                ) {
                                    neighbors += 1;
                                }
                            }
                        }
                        cellsActions[firstGeneration[i][k]][neighbors](k, i);
                        neighbors = 0;
                    }
                }
            }

            function playLife() {
                isPlaying = true;
                timer = setInterval(() => {
                    lifeCycle();
                    renderArea(secondGeneration);
                }, speed);
            }
            function stopLife() {
                isPlaying = false;
                clearInterval(timer);
            }
            function randomize() {
                firstGeneration = firstGeneration.map((item) =>
                    item.map((value) => randomInteger(0, 1))
                );
                renderArea(firstGeneration);
            }
            function randomInteger(min, max) {
                return Math.floor(min + Math.random() * (max + 1 - min));
            }
        </script>
    </body>
</html>
